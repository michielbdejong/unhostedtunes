
# TODO: add possibility to do streaming :)

module.exports = (config_dir, cb) ->
	Path = require \path
	tn = require Path.join __dirname, \build \Release \TransNode
	EventEmitter = require \events .EventEmitter

	var config

	ee = new EventEmitter
	tn.init config_dir, (evt, data) ->
		console.log "TransNode event:", evt, data
		ee.emit evt, data
	, (res) ->
		console.log "TransNode closed"
		ee.emit \exit
	, (res) ->
		if res.errorStatus
			err = new Error "TransNode returned err: #{res.errorStatus}"
			if typeof cb is \function
				cb err
			else
				ee.emit \error, err
		else
			cb null, ee if typeof cb is \function
			ee.emit \started config := res.configuration


	

	
	ee.mp3ToTorrent = tn.mp3ToTorrent
	ee.add = tn.add
	ee.list = tn.list
	ee.start = tn.start
	ee.stop = tn.stop
	ee.remove = tn.remove
	return ee


#info.files
#info.name
