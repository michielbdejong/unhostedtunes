module.exports = function(config_dir, cb){
  var Path, tn, EventEmitter, config, ee;
  Path = require('path');
  tn = require(Path.join(__dirname, 'build', 'Release', 'TransNode'));
  EventEmitter = require('events').EventEmitter;
  ee = new EventEmitter;
  tn.init(config_dir, function(evt, data){
    console.log("TransNode event:", evt, data);
    return ee.emit(evt, data);
  }, function(res){
    console.log("TransNode closed");
    return ee.emit('exit');
  }, function(res){
    var err;
    if (res.errorStatus) {
      err = new Error("TransNode returned err: " + res.errorStatus);
      if (typeof cb === 'function') {
        return cb(err);
      } else {
        return ee.emit('error', err);
      }
    } else {
      if (typeof cb === 'function') {
        cb(null, ee);
      }
      return ee.emit('started', config = res.configuration);
    }
  });
  ee.mp3ToTorrent = tn.mp3ToTorrent;
  ee.add = tn.add;
  ee.list = tn.list;
  ee.start = tn.start;
  ee.stop = tn.stop;
  ee.remove = tn.remove;
  return ee;
};